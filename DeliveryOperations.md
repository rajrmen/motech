# Introduction #

Module motech-delivery-ops in motech-delivery project (https://github.com/motech/motech-delivery) provides the configuration, deployment and operation related scripts. We use Ant, Puppet and shell scripts to automate the our processes. You can look at Ananya-Delivery, one of our implementations, (https://github.com/motech/ananya-delivery) as an example of this.


# Configuration #

Activities which are related to setting up a machine with all the third party software used in motech. We use Couch Db, MySQL, Tomcat, git, Java for motech. We use Puppet and Ant for automation.

Prerequisite : Cent OS 6.0 and root access.

run as root to configure the server environment.
```
wget https://raw.github.com/motech/motech-scm/master/bootstrap.sh && sh ./bootstrap.sh 
```

Script will prompt for configuration :

  * `$motechUser` :  linux user id used to run all services and deployment.
  * `$motechPassword` : password in encrypted format, can be generated by `echo "password" | openssl passwd -1 -stdin`
  * `$mysqlPassword` : my sql password for root user (plain text).

**Service Monitoring**
> Basic service monitoring can be configured by setting following params.
  * `$monitor_adminPhoneNumbers` : phone numbers separated by space (' ')
  * `$monitor_kookooKey` : Kookoo api key for sms and phone call notifications.
  * `$monitor_environment` : Environment name such as "motech primary server"

> Optionally, you can disable monitoring by commenting  following line
```
include monitor 
```

# Deployment #


# Operation #
All operations are performed using ant. We provide macrodefs which you can use to automate your operations activities. The properties which you need to set are indicated below within $foo$ sign.
All operation related macrodef are accessible from operationMacroDefs.xml. You can invoke appropriate macrodef and set the required attributes.

**Restore from backup (Couch DB and MySQL)**
```
macrodef: restore.db

run-from: master
```

**Backup (Couch DB and MySQL)**
```
macrodef: backup.db.to.location

run-from: master or slave
```

## Assuming master slave configuration ##
**When master goes down and slave needs to be brought up to serve the requests**
```
macrodef: start.slave.machine

run-from: slave
```

**When master comes back up the slave needs to be shutdown**
```
You need to run in the exact order.

macrodef: stop.slave.machine; run-from: slave

macrodef: start.master.machine; run-from: master
```


## Postgresql Replication ##
[Postgresql Replication](https://docs.google.com/a/thoughtworks.com/document/d/1jYNXjVzMb4c02KoifzOKD0u6woQenZF8AsF04fbtN78/edit)